"use strict";var hi=Object.create;var Me=Object.defineProperty;var mi=Object.getOwnPropertyDescriptor;var di=Object.getOwnPropertyNames;var pi=Object.getPrototypeOf,yi=Object.prototype.hasOwnProperty;var b=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),gi=(e,t)=>{for(var r in t)Me(e,r,{get:t[r],enumerable:!0})},At=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of di(t))!yi.call(e,i)&&i!==r&&Me(e,i,{get:()=>t[i],enumerable:!(n=mi(t,i))||n.enumerable});return e};var se=(e,t,r)=>(r=e!=null?hi(pi(e)):{},At(t||!e||!e.__esModule?Me(r,"default",{value:e,enumerable:!0}):r,e)),wi=e=>At(Me({},"__esModule",{value:!0}),e);var H=b(nt=>{"use strict";nt.fromCallback=function(e){return Object.defineProperty(function(...t){if(typeof t[t.length-1]=="function")e.apply(this,t);else return new Promise((r,n)=>{e.call(this,...t,(i,o)=>i!=null?n(i):r(o))})},"name",{value:e.name})};nt.fromPromise=function(e){return Object.defineProperty(function(...t){let r=t[t.length-1];if(typeof r!="function")return e.apply(this,t);e.apply(this,t.slice(0,-1)).then(n=>r(null,n),r)},"name",{value:e.name})}});var Vt=b((Ls,Dt)=>{var ae=require("constants"),vi=process.cwd,We=null,Si=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return We||(We=vi.call(process)),We};try{process.cwd()}catch{}typeof process.chdir=="function"&&(it=process.chdir,process.chdir=function(e){We=null,it.call(process,e)},Object.setPrototypeOf&&Object.setPrototypeOf(process.chdir,it));var it;Dt.exports=xi;function xi(e){ae.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&t(e),e.lutimes||r(e),e.chown=o(e.chown),e.fchown=o(e.fchown),e.lchown=o(e.lchown),e.chmod=n(e.chmod),e.fchmod=n(e.fchmod),e.lchmod=n(e.lchmod),e.chownSync=c(e.chownSync),e.fchownSync=c(e.fchownSync),e.lchownSync=c(e.lchownSync),e.chmodSync=i(e.chmodSync),e.fchmodSync=i(e.fchmodSync),e.lchmodSync=i(e.lchmodSync),e.stat=u(e.stat),e.fstat=u(e.fstat),e.lstat=u(e.lstat),e.statSync=s(e.statSync),e.fstatSync=s(e.fstatSync),e.lstatSync=s(e.lstatSync),e.chmod&&!e.lchmod&&(e.lchmod=function(f,a,l){l&&process.nextTick(l)},e.lchmodSync=function(){}),e.chown&&!e.lchown&&(e.lchown=function(f,a,l,d){d&&process.nextTick(d)},e.lchownSync=function(){}),Si==="win32"&&(e.rename=typeof e.rename!="function"?e.rename:function(f){function a(l,d,g){var v=Date.now(),x=0;f(l,d,function S(E){if(E&&(E.code==="EACCES"||E.code==="EPERM")&&Date.now()-v<6e4){setTimeout(function(){e.stat(d,function(C,W){C&&C.code==="ENOENT"?f(l,d,S):g(E)})},x),x<100&&(x+=10);return}g&&g(E)})}return Object.setPrototypeOf&&Object.setPrototypeOf(a,f),a}(e.rename)),e.read=typeof e.read!="function"?e.read:function(f){function a(l,d,g,v,x,S){var E;if(S&&typeof S=="function"){var C=0;E=function(W,B,Z){if(W&&W.code==="EAGAIN"&&C<10)return C++,f.call(e,l,d,g,v,x,E);S.apply(this,arguments)}}return f.call(e,l,d,g,v,x,E)}return Object.setPrototypeOf&&Object.setPrototypeOf(a,f),a}(e.read),e.readSync=typeof e.readSync!="function"?e.readSync:function(f){return function(a,l,d,g,v){for(var x=0;;)try{return f.call(e,a,l,d,g,v)}catch(S){if(S.code==="EAGAIN"&&x<10){x++;continue}throw S}}}(e.readSync);function t(f){f.lchmod=function(a,l,d){f.open(a,ae.O_WRONLY|ae.O_SYMLINK,l,function(g,v){if(g){d&&d(g);return}f.fchmod(v,l,function(x){f.close(v,function(S){d&&d(x||S)})})})},f.lchmodSync=function(a,l){var d=f.openSync(a,ae.O_WRONLY|ae.O_SYMLINK,l),g=!0,v;try{v=f.fchmodSync(d,l),g=!1}finally{if(g)try{f.closeSync(d)}catch{}else f.closeSync(d)}return v}}function r(f){ae.hasOwnProperty("O_SYMLINK")&&f.futimes?(f.lutimes=function(a,l,d,g){f.open(a,ae.O_SYMLINK,function(v,x){if(v){g&&g(v);return}f.futimes(x,l,d,function(S){f.close(x,function(E){g&&g(S||E)})})})},f.lutimesSync=function(a,l,d){var g=f.openSync(a,ae.O_SYMLINK),v,x=!0;try{v=f.futimesSync(g,l,d),x=!1}finally{if(x)try{f.closeSync(g)}catch{}else f.closeSync(g)}return v}):f.futimes&&(f.lutimes=function(a,l,d,g){g&&process.nextTick(g)},f.lutimesSync=function(){})}function n(f){return f&&function(a,l,d){return f.call(e,a,l,function(g){m(g)&&(g=null),d&&d.apply(this,arguments)})}}function i(f){return f&&function(a,l){try{return f.call(e,a,l)}catch(d){if(!m(d))throw d}}}function o(f){return f&&function(a,l,d,g){return f.call(e,a,l,d,function(v){m(v)&&(v=null),g&&g.apply(this,arguments)})}}function c(f){return f&&function(a,l,d){try{return f.call(e,a,l,d)}catch(g){if(!m(g))throw g}}}function u(f){return f&&function(a,l,d){typeof l=="function"&&(d=l,l=null);function g(v,x){x&&(x.uid<0&&(x.uid+=4294967296),x.gid<0&&(x.gid+=4294967296)),d&&d.apply(this,arguments)}return l?f.call(e,a,l,g):f.call(e,a,g)}}function s(f){return f&&function(a,l){var d=l?f.call(e,a,l):f.call(e,a);return d&&(d.uid<0&&(d.uid+=4294967296),d.gid<0&&(d.gid+=4294967296)),d}}function m(f){if(!f||f.code==="ENOSYS")return!0;var a=!process.getuid||process.getuid()!==0;return!!(a&&(f.code==="EINVAL"||f.code==="EPERM"))}}});var Wt=b((Gs,Mt)=>{var $t=require("stream").Stream;Mt.exports=Ti;function Ti(e){return{ReadStream:t,WriteStream:r};function t(n,i){if(!(this instanceof t))return new t(n,i);$t.call(this);var o=this;this.path=n,this.fd=null,this.readable=!0,this.paused=!1,this.flags="r",this.mode=438,this.bufferSize=64*1024,i=i||{};for(var c=Object.keys(i),u=0,s=c.length;u<s;u++){var m=c[u];this[m]=i[m]}if(this.encoding&&this.setEncoding(this.encoding),this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.end===void 0)this.end=1/0;else if(typeof this.end!="number")throw TypeError("end must be a Number");if(this.start>this.end)throw new Error("start must be <= end");this.pos=this.start}if(this.fd!==null){process.nextTick(function(){o._read()});return}e.open(this.path,this.flags,this.mode,function(f,a){if(f){o.emit("error",f),o.readable=!1;return}o.fd=a,o.emit("open",a),o._read()})}function r(n,i){if(!(this instanceof r))return new r(n,i);$t.call(this),this.path=n,this.fd=null,this.writable=!0,this.flags="w",this.encoding="binary",this.mode=438,this.bytesWritten=0,i=i||{};for(var o=Object.keys(i),c=0,u=o.length;c<u;c++){var s=o[c];this[s]=i[s]}if(this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.start<0)throw new Error("start must be >= zero");this.pos=this.start}this.busy=!1,this._queue=[],this.fd===null&&(this._open=e.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}}});var Rt=b((Bs,jt)=>{"use strict";jt.exports=Ei;var Pi=Object.getPrototypeOf||function(e){return e.__proto__};function Ei(e){if(e===null||typeof e!="object")return e;if(e instanceof Object)var t={__proto__:Pi(e)};else var t=Object.create(null);return Object.getOwnPropertyNames(e).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))}),t}});var J=b((Us,at)=>{var V=require("fs"),ki=Vt(),Ci=Wt(),Ni=Rt(),je=require("util"),L,Le;typeof Symbol=="function"&&typeof Symbol.for=="function"?(L=Symbol.for("graceful-fs.queue"),Le=Symbol.for("graceful-fs.previous")):(L="___graceful-fs.queue",Le="___graceful-fs.previous");function Fi(){}function Bt(e,t){Object.defineProperty(e,L,{get:function(){return t}})}var de=Fi;je.debuglog?de=je.debuglog("gfs4"):/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&(de=function(){var e=je.format.apply(je,arguments);e="GFS4: "+e.split(/\n/).join(`
GFS4: `),console.error(e)});V[L]||(Lt=global[L]||[],Bt(V,Lt),V.close=function(e){function t(r,n){return e.call(V,r,function(i){i||Gt(),typeof n=="function"&&n.apply(this,arguments)})}return Object.defineProperty(t,Le,{value:e}),t}(V.close),V.closeSync=function(e){function t(r){e.apply(V,arguments),Gt()}return Object.defineProperty(t,Le,{value:e}),t}(V.closeSync),/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&process.on("exit",function(){de(V[L]),require("assert").equal(V[L].length,0)}));var Lt;global[L]||Bt(global,V[L]);at.exports=ot(Ni(V));process.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&!V.__patched&&(at.exports=ot(V),V.__patched=!0);function ot(e){ki(e),e.gracefulify=ot,e.createReadStream=B,e.createWriteStream=Z;var t=e.readFile;e.readFile=r;function r(P,O,I){return typeof O=="function"&&(I=O,O=null),M(P,O,I);function M(A,D,y,h){return t(A,D,function(p){p&&(p.code==="EMFILE"||p.code==="ENFILE")?xe([M,[A,D,y],p,h||Date.now(),Date.now()]):typeof y=="function"&&y.apply(this,arguments)})}}var n=e.writeFile;e.writeFile=i;function i(P,O,I,M){return typeof I=="function"&&(M=I,I=null),A(P,O,I,M);function A(D,y,h,p,w){return n(D,y,h,function(T){T&&(T.code==="EMFILE"||T.code==="ENFILE")?xe([A,[D,y,h,p],T,w||Date.now(),Date.now()]):typeof p=="function"&&p.apply(this,arguments)})}}var o=e.appendFile;o&&(e.appendFile=c);function c(P,O,I,M){return typeof I=="function"&&(M=I,I=null),A(P,O,I,M);function A(D,y,h,p,w){return o(D,y,h,function(T){T&&(T.code==="EMFILE"||T.code==="ENFILE")?xe([A,[D,y,h,p],T,w||Date.now(),Date.now()]):typeof p=="function"&&p.apply(this,arguments)})}}var u=e.copyFile;u&&(e.copyFile=s);function s(P,O,I,M){return typeof I=="function"&&(M=I,I=0),A(P,O,I,M);function A(D,y,h,p,w){return u(D,y,h,function(T){T&&(T.code==="EMFILE"||T.code==="ENFILE")?xe([A,[D,y,h,p],T,w||Date.now(),Date.now()]):typeof p=="function"&&p.apply(this,arguments)})}}var m=e.readdir;e.readdir=a;var f=/^v[0-5]\./;function a(P,O,I){typeof O=="function"&&(I=O,O=null);var M=f.test(process.version)?function(y,h,p,w){return m(y,A(y,h,p,w))}:function(y,h,p,w){return m(y,h,A(y,h,p,w))};return M(P,O,I);function A(D,y,h,p){return function(w,T){w&&(w.code==="EMFILE"||w.code==="ENFILE")?xe([M,[D,y,h],w,p||Date.now(),Date.now()]):(T&&T.sort&&T.sort(),typeof h=="function"&&h.call(this,w,T))}}}if(process.version.substr(0,4)==="v0.8"){var l=Ci(e);S=l.ReadStream,C=l.WriteStream}var d=e.ReadStream;d&&(S.prototype=Object.create(d.prototype),S.prototype.open=E);var g=e.WriteStream;g&&(C.prototype=Object.create(g.prototype),C.prototype.open=W),Object.defineProperty(e,"ReadStream",{get:function(){return S},set:function(P){S=P},enumerable:!0,configurable:!0}),Object.defineProperty(e,"WriteStream",{get:function(){return C},set:function(P){C=P},enumerable:!0,configurable:!0});var v=S;Object.defineProperty(e,"FileReadStream",{get:function(){return v},set:function(P){v=P},enumerable:!0,configurable:!0});var x=C;Object.defineProperty(e,"FileWriteStream",{get:function(){return x},set:function(P){x=P},enumerable:!0,configurable:!0});function S(P,O){return this instanceof S?(d.apply(this,arguments),this):S.apply(Object.create(S.prototype),arguments)}function E(){var P=this;oe(P.path,P.flags,P.mode,function(O,I){O?(P.autoClose&&P.destroy(),P.emit("error",O)):(P.fd=I,P.emit("open",I),P.read())})}function C(P,O){return this instanceof C?(g.apply(this,arguments),this):C.apply(Object.create(C.prototype),arguments)}function W(){var P=this;oe(P.path,P.flags,P.mode,function(O,I){O?(P.destroy(),P.emit("error",O)):(P.fd=I,P.emit("open",I))})}function B(P,O){return new e.ReadStream(P,O)}function Z(P,O){return new e.WriteStream(P,O)}var X=e.open;e.open=oe;function oe(P,O,I,M){return typeof I=="function"&&(M=I,I=null),A(P,O,I,M);function A(D,y,h,p,w){return X(D,y,h,function(T,N){T&&(T.code==="EMFILE"||T.code==="ENFILE")?xe([A,[D,y,h,p],T,w||Date.now(),Date.now()]):typeof p=="function"&&p.apply(this,arguments)})}}return e}function xe(e){de("ENQUEUE",e[0].name,e[1]),V[L].push(e),st()}var Re;function Gt(){for(var e=Date.now(),t=0;t<V[L].length;++t)V[L][t].length>2&&(V[L][t][3]=e,V[L][t][4]=e);st()}function st(){if(clearTimeout(Re),Re=void 0,V[L].length!==0){var e=V[L].shift(),t=e[0],r=e[1],n=e[2],i=e[3],o=e[4];if(i===void 0)de("RETRY",t.name,r),t.apply(null,r);else if(Date.now()-i>=6e4){de("TIMEOUT",t.name,r);var c=r.pop();typeof c=="function"&&c.call(null,n)}else{var u=Date.now()-o,s=Math.max(o-i,1),m=Math.min(s*1.2,100);u>=m?(de("RETRY",t.name,r),t.apply(null,r.concat([i]))):V[L].push(e)}Re===void 0&&(Re=setTimeout(st,0))}}});var pe=b(ce=>{"use strict";var Ut=H().fromCallback,z=J(),bi=["access","appendFile","chmod","chown","close","copyFile","fchmod","fchown","fdatasync","fstat","fsync","ftruncate","futimes","lchmod","lchown","link","lstat","mkdir","mkdtemp","open","opendir","readdir","readFile","readlink","realpath","rename","rm","rmdir","stat","symlink","truncate","unlink","utimes","writeFile"].filter(e=>typeof z[e]=="function");Object.assign(ce,z);bi.forEach(e=>{ce[e]=Ut(z[e])});ce.exists=function(e,t){return typeof t=="function"?z.exists(e,t):new Promise(r=>z.exists(e,r))};ce.read=function(e,t,r,n,i,o){return typeof o=="function"?z.read(e,t,r,n,i,o):new Promise((c,u)=>{z.read(e,t,r,n,i,(s,m,f)=>{if(s)return u(s);c({bytesRead:m,buffer:f})})})};ce.write=function(e,t,...r){return typeof r[r.length-1]=="function"?z.write(e,t,...r):new Promise((n,i)=>{z.write(e,t,...r,(o,c,u)=>{if(o)return i(o);n({bytesWritten:c,buffer:u})})})};typeof z.writev=="function"&&(ce.writev=function(e,t,...r){return typeof r[r.length-1]=="function"?z.writev(e,t,...r):new Promise((n,i)=>{z.writev(e,t,...r,(o,c,u)=>{if(o)return i(o);n({bytesWritten:c,buffers:u})})})});typeof z.realpath.native=="function"?ce.realpath.native=Ut(z.realpath.native):process.emitWarning("fs.realpath.native is not a function. Is fs being monkey-patched?","Warning","fs-extra-WARN0003")});var Kt=b((Ks,Jt)=>{"use strict";var Ii=require("path");Jt.exports.checkPath=function(t){if(process.platform==="win32"&&/[<>:"|?*]/.test(t.replace(Ii.parse(t).root,""))){let n=new Error(`Path contains invalid characters: ${t}`);throw n.code="EINVAL",n}}});var Qt=b((Ys,ct)=>{"use strict";var Yt=pe(),{checkPath:Ht}=Kt(),zt=e=>{let t={mode:511};return typeof e=="number"?e:{...t,...e}.mode};ct.exports.makeDir=async(e,t)=>(Ht(e),Yt.mkdir(e,{mode:zt(t),recursive:!0}));ct.exports.makeDirSync=(e,t)=>(Ht(e),Yt.mkdirSync(e,{mode:zt(t),recursive:!0}))});var te=b((Hs,Xt)=>{"use strict";var Oi=H().fromPromise,{makeDir:_i,makeDirSync:ut}=Qt(),ft=Oi(_i);Xt.exports={mkdirs:ft,mkdirsSync:ut,mkdirp:ft,mkdirpSync:ut,ensureDir:ft,ensureDirSync:ut}});var ue=b((zs,er)=>{"use strict";var qi=H().fromPromise,Zt=pe();function Ai(e){return Zt.access(e).then(()=>!0).catch(()=>!1)}er.exports={pathExists:qi(Ai),pathExistsSync:Zt.existsSync}});var lt=b((Qs,tr)=>{"use strict";var Te=J();function Di(e,t,r,n){Te.open(e,"r+",(i,o)=>{if(i)return n(i);Te.futimes(o,t,r,c=>{Te.close(o,u=>{n&&n(c||u)})})})}function Vi(e,t,r){let n=Te.openSync(e,"r+");return Te.futimesSync(n,t,r),Te.closeSync(n)}tr.exports={utimesMillis:Di,utimesMillisSync:Vi}});var ye=b((Xs,ir)=>{"use strict";var Pe=pe(),R=require("path"),$i=require("util");function Mi(e,t,r){let n=r.dereference?i=>Pe.stat(i,{bigint:!0}):i=>Pe.lstat(i,{bigint:!0});return Promise.all([n(e),n(t).catch(i=>{if(i.code==="ENOENT")return null;throw i})]).then(([i,o])=>({srcStat:i,destStat:o}))}function Wi(e,t,r){let n,i=r.dereference?c=>Pe.statSync(c,{bigint:!0}):c=>Pe.lstatSync(c,{bigint:!0}),o=i(e);try{n=i(t)}catch(c){if(c.code==="ENOENT")return{srcStat:o,destStat:null};throw c}return{srcStat:o,destStat:n}}function ji(e,t,r,n,i){$i.callbackify(Mi)(e,t,n,(o,c)=>{if(o)return i(o);let{srcStat:u,destStat:s}=c;if(s){if(Ce(u,s)){let m=R.basename(e),f=R.basename(t);return r==="move"&&m!==f&&m.toLowerCase()===f.toLowerCase()?i(null,{srcStat:u,destStat:s,isChangingCase:!0}):i(new Error("Source and destination must not be the same."))}if(u.isDirectory()&&!s.isDirectory())return i(new Error(`Cannot overwrite non-directory '${t}' with directory '${e}'.`));if(!u.isDirectory()&&s.isDirectory())return i(new Error(`Cannot overwrite directory '${t}' with non-directory '${e}'.`))}return u.isDirectory()&&ht(e,t)?i(new Error(Ge(e,t,r))):i(null,{srcStat:u,destStat:s})})}function Ri(e,t,r,n){let{srcStat:i,destStat:o}=Wi(e,t,n);if(o){if(Ce(i,o)){let c=R.basename(e),u=R.basename(t);if(r==="move"&&c!==u&&c.toLowerCase()===u.toLowerCase())return{srcStat:i,destStat:o,isChangingCase:!0};throw new Error("Source and destination must not be the same.")}if(i.isDirectory()&&!o.isDirectory())throw new Error(`Cannot overwrite non-directory '${t}' with directory '${e}'.`);if(!i.isDirectory()&&o.isDirectory())throw new Error(`Cannot overwrite directory '${t}' with non-directory '${e}'.`)}if(i.isDirectory()&&ht(e,t))throw new Error(Ge(e,t,r));return{srcStat:i,destStat:o}}function rr(e,t,r,n,i){let o=R.resolve(R.dirname(e)),c=R.resolve(R.dirname(r));if(c===o||c===R.parse(c).root)return i();Pe.stat(c,{bigint:!0},(u,s)=>u?u.code==="ENOENT"?i():i(u):Ce(t,s)?i(new Error(Ge(e,r,n))):rr(e,t,c,n,i))}function nr(e,t,r,n){let i=R.resolve(R.dirname(e)),o=R.resolve(R.dirname(r));if(o===i||o===R.parse(o).root)return;let c;try{c=Pe.statSync(o,{bigint:!0})}catch(u){if(u.code==="ENOENT")return;throw u}if(Ce(t,c))throw new Error(Ge(e,r,n));return nr(e,t,o,n)}function Ce(e,t){return t.ino&&t.dev&&t.ino===e.ino&&t.dev===e.dev}function ht(e,t){let r=R.resolve(e).split(R.sep).filter(i=>i),n=R.resolve(t).split(R.sep).filter(i=>i);return r.reduce((i,o,c)=>i&&n[c]===o,!0)}function Ge(e,t,r){return`Cannot ${r} '${e}' to a subdirectory of itself, '${t}'.`}ir.exports={checkPaths:ji,checkPathsSync:Ri,checkParentPaths:rr,checkParentPathsSync:nr,isSrcSubdir:ht,areIdentical:Ce}});var hr=b((Zs,lr)=>{"use strict";var Q=J(),Ne=require("path"),Li=te().mkdirs,Gi=ue().pathExists,Bi=lt().utimesMillis,Fe=ye();function Ui(e,t,r,n){typeof r=="function"&&!n?(n=r,r={}):typeof r=="function"&&(r={filter:r}),n=n||function(){},r=r||{},r.clobber="clobber"in r?!!r.clobber:!0,r.overwrite="overwrite"in r?!!r.overwrite:r.clobber,r.preserveTimestamps&&process.arch==="ia32"&&process.emitWarning(`Using the preserveTimestamps option in 32-bit node is not recommended;

	see https://github.com/jprichardson/node-fs-extra/issues/269`,"Warning","fs-extra-WARN0001"),Fe.checkPaths(e,t,"copy",r,(i,o)=>{if(i)return n(i);let{srcStat:c,destStat:u}=o;Fe.checkParentPaths(e,c,t,"copy",s=>s?n(s):r.filter?ar(or,u,e,t,r,n):or(u,e,t,r,n))})}function or(e,t,r,n,i){let o=Ne.dirname(r);Gi(o,(c,u)=>{if(c)return i(c);if(u)return Be(e,t,r,n,i);Li(o,s=>s?i(s):Be(e,t,r,n,i))})}function ar(e,t,r,n,i,o){Promise.resolve(i.filter(r,n)).then(c=>c?e(t,r,n,i,o):o(),c=>o(c))}function Ji(e,t,r,n,i){return n.filter?ar(Be,e,t,r,n,i):Be(e,t,r,n,i)}function Be(e,t,r,n,i){(n.dereference?Q.stat:Q.lstat)(t,(c,u)=>c?i(c):u.isDirectory()?Zi(u,e,t,r,n,i):u.isFile()||u.isCharacterDevice()||u.isBlockDevice()?Ki(u,e,t,r,n,i):u.isSymbolicLink()?ro(e,t,r,n,i):u.isSocket()?i(new Error(`Cannot copy a socket file: ${t}`)):u.isFIFO()?i(new Error(`Cannot copy a FIFO pipe: ${t}`)):i(new Error(`Unknown file: ${t}`)))}function Ki(e,t,r,n,i,o){return t?Yi(e,r,n,i,o):cr(e,r,n,i,o)}function Yi(e,t,r,n,i){if(n.overwrite)Q.unlink(r,o=>o?i(o):cr(e,t,r,n,i));else return n.errorOnExist?i(new Error(`'${r}' already exists`)):i()}function cr(e,t,r,n,i){Q.copyFile(t,r,o=>o?i(o):n.preserveTimestamps?Hi(e.mode,t,r,i):Ue(r,e.mode,i))}function Hi(e,t,r,n){return zi(e)?Qi(r,e,i=>i?n(i):sr(e,t,r,n)):sr(e,t,r,n)}function zi(e){return(e&128)===0}function Qi(e,t,r){return Ue(e,t|128,r)}function sr(e,t,r,n){Xi(t,r,i=>i?n(i):Ue(r,e,n))}function Ue(e,t,r){return Q.chmod(e,t,r)}function Xi(e,t,r){Q.stat(e,(n,i)=>n?r(n):Bi(t,i.atime,i.mtime,r))}function Zi(e,t,r,n,i,o){return t?ur(r,n,i,o):eo(e.mode,r,n,i,o)}function eo(e,t,r,n,i){Q.mkdir(r,o=>{if(o)return i(o);ur(t,r,n,c=>c?i(c):Ue(r,e,i))})}function ur(e,t,r,n){Q.readdir(e,(i,o)=>i?n(i):fr(o,e,t,r,n))}function fr(e,t,r,n,i){let o=e.pop();return o?to(e,o,t,r,n,i):i()}function to(e,t,r,n,i,o){let c=Ne.join(r,t),u=Ne.join(n,t);Fe.checkPaths(c,u,"copy",i,(s,m)=>{if(s)return o(s);let{destStat:f}=m;Ji(f,c,u,i,a=>a?o(a):fr(e,r,n,i,o))})}function ro(e,t,r,n,i){Q.readlink(t,(o,c)=>{if(o)return i(o);if(n.dereference&&(c=Ne.resolve(process.cwd(),c)),e)Q.readlink(r,(u,s)=>u?u.code==="EINVAL"||u.code==="UNKNOWN"?Q.symlink(c,r,i):i(u):(n.dereference&&(s=Ne.resolve(process.cwd(),s)),Fe.isSrcSubdir(c,s)?i(new Error(`Cannot copy '${c}' to a subdirectory of itself, '${s}'.`)):e.isDirectory()&&Fe.isSrcSubdir(s,c)?i(new Error(`Cannot overwrite '${s}' with '${c}'.`)):no(c,r,i)));else return Q.symlink(c,r,i)})}function no(e,t,r){Q.unlink(t,n=>n?r(n):Q.symlink(e,t,r))}lr.exports=Ui});var gr=b((ea,yr)=>{"use strict";var U=J(),be=require("path"),io=te().mkdirsSync,oo=lt().utimesMillisSync,Ie=ye();function so(e,t,r){typeof r=="function"&&(r={filter:r}),r=r||{},r.clobber="clobber"in r?!!r.clobber:!0,r.overwrite="overwrite"in r?!!r.overwrite:r.clobber,r.preserveTimestamps&&process.arch==="ia32"&&process.emitWarning(`Using the preserveTimestamps option in 32-bit node is not recommended;

	see https://github.com/jprichardson/node-fs-extra/issues/269`,"Warning","fs-extra-WARN0002");let{srcStat:n,destStat:i}=Ie.checkPathsSync(e,t,"copy",r);return Ie.checkParentPathsSync(e,n,t,"copy"),ao(i,e,t,r)}function ao(e,t,r,n){if(n.filter&&!n.filter(t,r))return;let i=be.dirname(r);return U.existsSync(i)||io(i),mr(e,t,r,n)}function co(e,t,r,n){if(!(n.filter&&!n.filter(t,r)))return mr(e,t,r,n)}function mr(e,t,r,n){let o=(n.dereference?U.statSync:U.lstatSync)(t);if(o.isDirectory())return yo(o,e,t,r,n);if(o.isFile()||o.isCharacterDevice()||o.isBlockDevice())return uo(o,e,t,r,n);if(o.isSymbolicLink())return vo(e,t,r,n);throw o.isSocket()?new Error(`Cannot copy a socket file: ${t}`):o.isFIFO()?new Error(`Cannot copy a FIFO pipe: ${t}`):new Error(`Unknown file: ${t}`)}function uo(e,t,r,n,i){return t?fo(e,r,n,i):dr(e,r,n,i)}function fo(e,t,r,n){if(n.overwrite)return U.unlinkSync(r),dr(e,t,r,n);if(n.errorOnExist)throw new Error(`'${r}' already exists`)}function dr(e,t,r,n){return U.copyFileSync(t,r),n.preserveTimestamps&&lo(e.mode,t,r),mt(r,e.mode)}function lo(e,t,r){return ho(e)&&mo(r,e),po(t,r)}function ho(e){return(e&128)===0}function mo(e,t){return mt(e,t|128)}function mt(e,t){return U.chmodSync(e,t)}function po(e,t){let r=U.statSync(e);return oo(t,r.atime,r.mtime)}function yo(e,t,r,n,i){return t?pr(r,n,i):go(e.mode,r,n,i)}function go(e,t,r,n){return U.mkdirSync(r),pr(t,r,n),mt(r,e)}function pr(e,t,r){U.readdirSync(e).forEach(n=>wo(n,e,t,r))}function wo(e,t,r,n){let i=be.join(t,e),o=be.join(r,e),{destStat:c}=Ie.checkPathsSync(i,o,"copy",n);return co(c,i,o,n)}function vo(e,t,r,n){let i=U.readlinkSync(t);if(n.dereference&&(i=be.resolve(process.cwd(),i)),e){let o;try{o=U.readlinkSync(r)}catch(c){if(c.code==="EINVAL"||c.code==="UNKNOWN")return U.symlinkSync(i,r);throw c}if(n.dereference&&(o=be.resolve(process.cwd(),o)),Ie.isSrcSubdir(i,o))throw new Error(`Cannot copy '${i}' to a subdirectory of itself, '${o}'.`);if(U.statSync(r).isDirectory()&&Ie.isSrcSubdir(o,i))throw new Error(`Cannot overwrite '${o}' with '${i}'.`);return So(i,r)}else return U.symlinkSync(i,r)}function So(e,t){return U.unlinkSync(t),U.symlinkSync(e,t)}yr.exports=so});var Je=b((ta,wr)=>{"use strict";var xo=H().fromCallback;wr.exports={copy:xo(hr()),copySync:gr()}});var Nr=b((ra,Cr)=>{"use strict";var vr=J(),Pr=require("path"),q=require("assert"),Oe=process.platform==="win32";function Er(e){["unlink","chmod","stat","lstat","rmdir","readdir"].forEach(r=>{e[r]=e[r]||vr[r],r=r+"Sync",e[r]=e[r]||vr[r]}),e.maxBusyTries=e.maxBusyTries||3}function dt(e,t,r){let n=0;typeof t=="function"&&(r=t,t={}),q(e,"rimraf: missing path"),q.strictEqual(typeof e,"string","rimraf: path should be a string"),q.strictEqual(typeof r,"function","rimraf: callback function required"),q(t,"rimraf: invalid options argument provided"),q.strictEqual(typeof t,"object","rimraf: options should be object"),Er(t),Sr(e,t,function i(o){if(o){if((o.code==="EBUSY"||o.code==="ENOTEMPTY"||o.code==="EPERM")&&n<t.maxBusyTries){n++;let c=n*100;return setTimeout(()=>Sr(e,t,i),c)}o.code==="ENOENT"&&(o=null)}r(o)})}function Sr(e,t,r){q(e),q(t),q(typeof r=="function"),t.lstat(e,(n,i)=>{if(n&&n.code==="ENOENT")return r(null);if(n&&n.code==="EPERM"&&Oe)return xr(e,t,n,r);if(i&&i.isDirectory())return Ke(e,t,n,r);t.unlink(e,o=>{if(o){if(o.code==="ENOENT")return r(null);if(o.code==="EPERM")return Oe?xr(e,t,o,r):Ke(e,t,o,r);if(o.code==="EISDIR")return Ke(e,t,o,r)}return r(o)})})}function xr(e,t,r,n){q(e),q(t),q(typeof n=="function"),t.chmod(e,438,i=>{i?n(i.code==="ENOENT"?null:r):t.stat(e,(o,c)=>{o?n(o.code==="ENOENT"?null:r):c.isDirectory()?Ke(e,t,r,n):t.unlink(e,n)})})}function Tr(e,t,r){let n;q(e),q(t);try{t.chmodSync(e,438)}catch(i){if(i.code==="ENOENT")return;throw r}try{n=t.statSync(e)}catch(i){if(i.code==="ENOENT")return;throw r}n.isDirectory()?Ye(e,t,r):t.unlinkSync(e)}function Ke(e,t,r,n){q(e),q(t),q(typeof n=="function"),t.rmdir(e,i=>{i&&(i.code==="ENOTEMPTY"||i.code==="EEXIST"||i.code==="EPERM")?To(e,t,n):i&&i.code==="ENOTDIR"?n(r):n(i)})}function To(e,t,r){q(e),q(t),q(typeof r=="function"),t.readdir(e,(n,i)=>{if(n)return r(n);let o=i.length,c;if(o===0)return t.rmdir(e,r);i.forEach(u=>{dt(Pr.join(e,u),t,s=>{if(!c){if(s)return r(c=s);--o===0&&t.rmdir(e,r)}})})})}function kr(e,t){let r;t=t||{},Er(t),q(e,"rimraf: missing path"),q.strictEqual(typeof e,"string","rimraf: path should be a string"),q(t,"rimraf: missing options"),q.strictEqual(typeof t,"object","rimraf: options should be object");try{r=t.lstatSync(e)}catch(n){if(n.code==="ENOENT")return;n.code==="EPERM"&&Oe&&Tr(e,t,n)}try{r&&r.isDirectory()?Ye(e,t,null):t.unlinkSync(e)}catch(n){if(n.code==="ENOENT")return;if(n.code==="EPERM")return Oe?Tr(e,t,n):Ye(e,t,n);if(n.code!=="EISDIR")throw n;Ye(e,t,n)}}function Ye(e,t,r){q(e),q(t);try{t.rmdirSync(e)}catch(n){if(n.code==="ENOTDIR")throw r;if(n.code==="ENOTEMPTY"||n.code==="EEXIST"||n.code==="EPERM")Po(e,t);else if(n.code!=="ENOENT")throw n}}function Po(e,t){if(q(e),q(t),t.readdirSync(e).forEach(r=>kr(Pr.join(e,r),t)),Oe){let r=Date.now();do try{return t.rmdirSync(e,t)}catch{}while(Date.now()-r<500)}else return t.rmdirSync(e,t)}Cr.exports=dt;dt.sync=kr});var _e=b((na,br)=>{"use strict";var He=J(),Eo=H().fromCallback,Fr=Nr();function ko(e,t){if(He.rm)return He.rm(e,{recursive:!0,force:!0},t);Fr(e,t)}function Co(e){if(He.rmSync)return He.rmSync(e,{recursive:!0,force:!0});Fr.sync(e)}br.exports={remove:Eo(ko),removeSync:Co}});var $r=b((ia,Vr)=>{"use strict";var No=H().fromPromise,_r=pe(),qr=require("path"),Ar=te(),Dr=_e(),Ir=No(async function(t){let r;try{r=await _r.readdir(t)}catch{return Ar.mkdirs(t)}return Promise.all(r.map(n=>Dr.remove(qr.join(t,n))))});function Or(e){let t;try{t=_r.readdirSync(e)}catch{return Ar.mkdirsSync(e)}t.forEach(r=>{r=qr.join(e,r),Dr.removeSync(r)})}Vr.exports={emptyDirSync:Or,emptydirSync:Or,emptyDir:Ir,emptydir:Ir}});var Rr=b((oa,jr)=>{"use strict";var Fo=H().fromCallback,Mr=require("path"),fe=J(),Wr=te();function bo(e,t){function r(){fe.writeFile(e,"",n=>{if(n)return t(n);t()})}fe.stat(e,(n,i)=>{if(!n&&i.isFile())return t();let o=Mr.dirname(e);fe.stat(o,(c,u)=>{if(c)return c.code==="ENOENT"?Wr.mkdirs(o,s=>{if(s)return t(s);r()}):t(c);u.isDirectory()?r():fe.readdir(o,s=>{if(s)return t(s)})})})}function Io(e){let t;try{t=fe.statSync(e)}catch{}if(t&&t.isFile())return;let r=Mr.dirname(e);try{fe.statSync(r).isDirectory()||fe.readdirSync(r)}catch(n){if(n&&n.code==="ENOENT")Wr.mkdirsSync(r);else throw n}fe.writeFileSync(e,"")}jr.exports={createFile:Fo(bo),createFileSync:Io}});var Jr=b((sa,Ur)=>{"use strict";var Oo=H().fromCallback,Lr=require("path"),le=J(),Gr=te(),_o=ue().pathExists,{areIdentical:Br}=ye();function qo(e,t,r){function n(i,o){le.link(i,o,c=>{if(c)return r(c);r(null)})}le.lstat(t,(i,o)=>{le.lstat(e,(c,u)=>{if(c)return c.message=c.message.replace("lstat","ensureLink"),r(c);if(o&&Br(u,o))return r(null);let s=Lr.dirname(t);_o(s,(m,f)=>{if(m)return r(m);if(f)return n(e,t);Gr.mkdirs(s,a=>{if(a)return r(a);n(e,t)})})})})}function Ao(e,t){let r;try{r=le.lstatSync(t)}catch{}try{let o=le.lstatSync(e);if(r&&Br(o,r))return}catch(o){throw o.message=o.message.replace("lstat","ensureLink"),o}let n=Lr.dirname(t);return le.existsSync(n)||Gr.mkdirsSync(n),le.linkSync(e,t)}Ur.exports={createLink:Oo(qo),createLinkSync:Ao}});var Yr=b((aa,Kr)=>{"use strict";var he=require("path"),qe=J(),Do=ue().pathExists;function Vo(e,t,r){if(he.isAbsolute(e))return qe.lstat(e,n=>n?(n.message=n.message.replace("lstat","ensureSymlink"),r(n)):r(null,{toCwd:e,toDst:e}));{let n=he.dirname(t),i=he.join(n,e);return Do(i,(o,c)=>o?r(o):c?r(null,{toCwd:i,toDst:e}):qe.lstat(e,u=>u?(u.message=u.message.replace("lstat","ensureSymlink"),r(u)):r(null,{toCwd:e,toDst:he.relative(n,e)})))}}function $o(e,t){let r;if(he.isAbsolute(e)){if(r=qe.existsSync(e),!r)throw new Error("absolute srcpath does not exist");return{toCwd:e,toDst:e}}else{let n=he.dirname(t),i=he.join(n,e);if(r=qe.existsSync(i),r)return{toCwd:i,toDst:e};if(r=qe.existsSync(e),!r)throw new Error("relative srcpath does not exist");return{toCwd:e,toDst:he.relative(n,e)}}}Kr.exports={symlinkPaths:Vo,symlinkPathsSync:$o}});var Qr=b((ca,zr)=>{"use strict";var Hr=J();function Mo(e,t,r){if(r=typeof t=="function"?t:r,t=typeof t=="function"?!1:t,t)return r(null,t);Hr.lstat(e,(n,i)=>{if(n)return r(null,"file");t=i&&i.isDirectory()?"dir":"file",r(null,t)})}function Wo(e,t){let r;if(t)return t;try{r=Hr.lstatSync(e)}catch{return"file"}return r&&r.isDirectory()?"dir":"file"}zr.exports={symlinkType:Mo,symlinkTypeSync:Wo}});var sn=b((ua,on)=>{"use strict";var jo=H().fromCallback,Zr=require("path"),re=pe(),en=te(),Ro=en.mkdirs,Lo=en.mkdirsSync,tn=Yr(),Go=tn.symlinkPaths,Bo=tn.symlinkPathsSync,rn=Qr(),Uo=rn.symlinkType,Jo=rn.symlinkTypeSync,Ko=ue().pathExists,{areIdentical:nn}=ye();function Yo(e,t,r,n){n=typeof r=="function"?r:n,r=typeof r=="function"?!1:r,re.lstat(t,(i,o)=>{!i&&o.isSymbolicLink()?Promise.all([re.stat(e),re.stat(t)]).then(([c,u])=>{if(nn(c,u))return n(null);Xr(e,t,r,n)}):Xr(e,t,r,n)})}function Xr(e,t,r,n){Go(e,t,(i,o)=>{if(i)return n(i);e=o.toDst,Uo(o.toCwd,r,(c,u)=>{if(c)return n(c);let s=Zr.dirname(t);Ko(s,(m,f)=>{if(m)return n(m);if(f)return re.symlink(e,t,u,n);Ro(s,a=>{if(a)return n(a);re.symlink(e,t,u,n)})})})})}function Ho(e,t,r){let n;try{n=re.lstatSync(t)}catch{}if(n&&n.isSymbolicLink()){let u=re.statSync(e),s=re.statSync(t);if(nn(u,s))return}let i=Bo(e,t);e=i.toDst,r=Jo(i.toCwd,r);let o=Zr.dirname(t);return re.existsSync(o)||Lo(o),re.symlinkSync(e,t,r)}on.exports={createSymlink:jo(Yo),createSymlinkSync:Ho}});var dn=b((fa,mn)=>{"use strict";var{createFile:an,createFileSync:cn}=Rr(),{createLink:un,createLinkSync:fn}=Jr(),{createSymlink:ln,createSymlinkSync:hn}=sn();mn.exports={createFile:an,createFileSync:cn,ensureFile:an,ensureFileSync:cn,createLink:un,createLinkSync:fn,ensureLink:un,ensureLinkSync:fn,createSymlink:ln,createSymlinkSync:hn,ensureSymlink:ln,ensureSymlinkSync:hn}});var ze=b((la,pn)=>{function zo(e,{EOL:t=`
`,finalEOL:r=!0,replacer:n=null,spaces:i}={}){let o=r?t:"";return JSON.stringify(e,n,i).replace(/\n/g,t)+o}function Qo(e){return Buffer.isBuffer(e)&&(e=e.toString("utf8")),e.replace(/^\uFEFF/,"")}pn.exports={stringify:zo,stripBom:Qo}});var vn=b((ha,wn)=>{var Ee;try{Ee=J()}catch{Ee=require("fs")}var Qe=H(),{stringify:yn,stripBom:gn}=ze();async function Xo(e,t={}){typeof t=="string"&&(t={encoding:t});let r=t.fs||Ee,n="throws"in t?t.throws:!0,i=await Qe.fromCallback(r.readFile)(e,t);i=gn(i);let o;try{o=JSON.parse(i,t?t.reviver:null)}catch(c){if(n)throw c.message=`${e}: ${c.message}`,c;return null}return o}var Zo=Qe.fromPromise(Xo);function es(e,t={}){typeof t=="string"&&(t={encoding:t});let r=t.fs||Ee,n="throws"in t?t.throws:!0;try{let i=r.readFileSync(e,t);return i=gn(i),JSON.parse(i,t.reviver)}catch(i){if(n)throw i.message=`${e}: ${i.message}`,i;return null}}async function ts(e,t,r={}){let n=r.fs||Ee,i=yn(t,r);await Qe.fromCallback(n.writeFile)(e,i,r)}var rs=Qe.fromPromise(ts);function ns(e,t,r={}){let n=r.fs||Ee,i=yn(t,r);return n.writeFileSync(e,i,r)}var is={readFile:Zo,readFileSync:es,writeFile:rs,writeFileSync:ns};wn.exports=is});var xn=b((ma,Sn)=>{"use strict";var Xe=vn();Sn.exports={readJson:Xe.readFile,readJsonSync:Xe.readFileSync,writeJson:Xe.writeFile,writeJsonSync:Xe.writeFileSync}});var Ze=b((da,En)=>{"use strict";var os=H().fromCallback,Ae=J(),Tn=require("path"),Pn=te(),ss=ue().pathExists;function as(e,t,r,n){typeof r=="function"&&(n=r,r="utf8");let i=Tn.dirname(e);ss(i,(o,c)=>{if(o)return n(o);if(c)return Ae.writeFile(e,t,r,n);Pn.mkdirs(i,u=>{if(u)return n(u);Ae.writeFile(e,t,r,n)})})}function cs(e,...t){let r=Tn.dirname(e);if(Ae.existsSync(r))return Ae.writeFileSync(e,...t);Pn.mkdirsSync(r),Ae.writeFileSync(e,...t)}En.exports={outputFile:os(as),outputFileSync:cs}});var Cn=b((pa,kn)=>{"use strict";var{stringify:us}=ze(),{outputFile:fs}=Ze();async function ls(e,t,r={}){let n=us(t,r);await fs(e,n,r)}kn.exports=ls});var Fn=b((ya,Nn)=>{"use strict";var{stringify:hs}=ze(),{outputFileSync:ms}=Ze();function ds(e,t,r){let n=hs(t,r);ms(e,n,r)}Nn.exports=ds});var In=b((ga,bn)=>{"use strict";var ps=H().fromPromise,K=xn();K.outputJson=ps(Cn());K.outputJsonSync=Fn();K.outputJSON=K.outputJson;K.outputJSONSync=K.outputJsonSync;K.writeJSON=K.writeJson;K.writeJSONSync=K.writeJsonSync;K.readJSON=K.readJson;K.readJSONSync=K.readJsonSync;bn.exports=K});var Dn=b((wa,An)=>{"use strict";var ys=J(),yt=require("path"),gs=Je().copy,qn=_e().remove,ws=te().mkdirp,vs=ue().pathExists,On=ye();function Ss(e,t,r,n){typeof r=="function"&&(n=r,r={}),r=r||{};let i=r.overwrite||r.clobber||!1;On.checkPaths(e,t,"move",r,(o,c)=>{if(o)return n(o);let{srcStat:u,isChangingCase:s=!1}=c;On.checkParentPaths(e,u,t,"move",m=>{if(m)return n(m);if(xs(t))return _n(e,t,i,s,n);ws(yt.dirname(t),f=>f?n(f):_n(e,t,i,s,n))})})}function xs(e){let t=yt.dirname(e);return yt.parse(t).root===t}function _n(e,t,r,n,i){if(n)return pt(e,t,r,i);if(r)return qn(t,o=>o?i(o):pt(e,t,r,i));vs(t,(o,c)=>o?i(o):c?i(new Error("dest already exists.")):pt(e,t,r,i))}function pt(e,t,r,n){ys.rename(e,t,i=>i?i.code!=="EXDEV"?n(i):Ts(e,t,r,n):n())}function Ts(e,t,r,n){gs(e,t,{overwrite:r,errorOnExist:!0},o=>o?n(o):qn(e,n))}An.exports=Ss});var jn=b((va,Wn)=>{"use strict";var $n=J(),wt=require("path"),Ps=Je().copySync,Mn=_e().removeSync,Es=te().mkdirpSync,Vn=ye();function ks(e,t,r){r=r||{};let n=r.overwrite||r.clobber||!1,{srcStat:i,isChangingCase:o=!1}=Vn.checkPathsSync(e,t,"move",r);return Vn.checkParentPathsSync(e,i,t,"move"),Cs(t)||Es(wt.dirname(t)),Ns(e,t,n,o)}function Cs(e){let t=wt.dirname(e);return wt.parse(t).root===t}function Ns(e,t,r,n){if(n)return gt(e,t,r);if(r)return Mn(t),gt(e,t,r);if($n.existsSync(t))throw new Error("dest already exists.");return gt(e,t,r)}function gt(e,t,r){try{$n.renameSync(e,t)}catch(n){if(n.code!=="EXDEV")throw n;return Fs(e,t,r)}}function Fs(e,t,r){return Ps(e,t,{overwrite:r,errorOnExist:!0}),Mn(e)}Wn.exports=ks});var Ln=b((Sa,Rn)=>{"use strict";var bs=H().fromCallback;Rn.exports={move:bs(Dn()),moveSync:jn()}});var De=b((xa,Gn)=>{"use strict";Gn.exports={...pe(),...Je(),...$r(),...dn(),...In(),...te(),...Ln(),...Ze(),...ue(),..._e()}});var Ws={};gi(Ws,{activate:()=>$s,log:()=>Ve});module.exports=wi(Ws);var Un=require("coc.nvim"),Jn=se(De()),Kn=require("path"),vt=(0,Jn.readJsonSync)((0,Kn.resolve)(__dirname,"../package.json")),Is=vt.contributes.configuration.properties["todo-tree.defaultView"].enum,Yn=vt.name,et=Un.workspace.getConfiguration().get("todo-tree"),Bn=vt.contributes.configuration.properties,Os=Object.keys(Bn).reduce((e,t)=>(e[t.replace(new RegExp(`${Yn.replace("coc-","")}\\.`),"")]=Bn[t].default,e),{}),Hn={};et&&et.tags&&(Hn.tags=et.tags.filter((e,t,r)=>r.findIndex(n=>n.tagName===e.tagName&&n.regex===e.regex)===t));var ee=Is,ie=Yn,ge=Os,F={...et,...Hn};var $=require("coc.nvim"),ai=se(De()),ci=se(require("path"));var zn;(()=>{"use strict";var e={470:i=>{function o(s){if(typeof s!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(s))}function c(s,m){for(var f,a="",l=0,d=-1,g=0,v=0;v<=s.length;++v){if(v<s.length)f=s.charCodeAt(v);else{if(f===47)break;f=47}if(f===47){if(!(d===v-1||g===1))if(d!==v-1&&g===2){if(a.length<2||l!==2||a.charCodeAt(a.length-1)!==46||a.charCodeAt(a.length-2)!==46){if(a.length>2){var x=a.lastIndexOf("/");if(x!==a.length-1){x===-1?(a="",l=0):l=(a=a.slice(0,x)).length-1-a.lastIndexOf("/"),d=v,g=0;continue}}else if(a.length===2||a.length===1){a="",l=0,d=v,g=0;continue}}m&&(a.length>0?a+="/..":a="..",l=2)}else a.length>0?a+="/"+s.slice(d+1,v):a=s.slice(d+1,v),l=v-d-1;d=v,g=0}else f===46&&g!==-1?++g:g=-1}return a}var u={resolve:function(){for(var s,m="",f=!1,a=arguments.length-1;a>=-1&&!f;a--){var l;a>=0?l=arguments[a]:(s===void 0&&(s=process.cwd()),l=s),o(l),l.length!==0&&(m=l+"/"+m,f=l.charCodeAt(0)===47)}return m=c(m,!f),f?m.length>0?"/"+m:"/":m.length>0?m:"."},normalize:function(s){if(o(s),s.length===0)return".";var m=s.charCodeAt(0)===47,f=s.charCodeAt(s.length-1)===47;return(s=c(s,!m)).length!==0||m||(s="."),s.length>0&&f&&(s+="/"),m?"/"+s:s},isAbsolute:function(s){return o(s),s.length>0&&s.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var s,m=0;m<arguments.length;++m){var f=arguments[m];o(f),f.length>0&&(s===void 0?s=f:s+="/"+f)}return s===void 0?".":u.normalize(s)},relative:function(s,m){if(o(s),o(m),s===m||(s=u.resolve(s))===(m=u.resolve(m)))return"";for(var f=1;f<s.length&&s.charCodeAt(f)===47;++f);for(var a=s.length,l=a-f,d=1;d<m.length&&m.charCodeAt(d)===47;++d);for(var g=m.length-d,v=l<g?l:g,x=-1,S=0;S<=v;++S){if(S===v){if(g>v){if(m.charCodeAt(d+S)===47)return m.slice(d+S+1);if(S===0)return m.slice(d+S)}else l>v&&(s.charCodeAt(f+S)===47?x=S:S===0&&(x=0));break}var E=s.charCodeAt(f+S);if(E!==m.charCodeAt(d+S))break;E===47&&(x=S)}var C="";for(S=f+x+1;S<=a;++S)S!==a&&s.charCodeAt(S)!==47||(C.length===0?C+="..":C+="/..");return C.length>0?C+m.slice(d+x):(d+=x,m.charCodeAt(d)===47&&++d,m.slice(d))},_makeLong:function(s){return s},dirname:function(s){if(o(s),s.length===0)return".";for(var m=s.charCodeAt(0),f=m===47,a=-1,l=!0,d=s.length-1;d>=1;--d)if((m=s.charCodeAt(d))===47){if(!l){a=d;break}}else l=!1;return a===-1?f?"/":".":f&&a===1?"//":s.slice(0,a)},basename:function(s,m){if(m!==void 0&&typeof m!="string")throw new TypeError('"ext" argument must be a string');o(s);var f,a=0,l=-1,d=!0;if(m!==void 0&&m.length>0&&m.length<=s.length){if(m.length===s.length&&m===s)return"";var g=m.length-1,v=-1;for(f=s.length-1;f>=0;--f){var x=s.charCodeAt(f);if(x===47){if(!d){a=f+1;break}}else v===-1&&(d=!1,v=f+1),g>=0&&(x===m.charCodeAt(g)?--g==-1&&(l=f):(g=-1,l=v))}return a===l?l=v:l===-1&&(l=s.length),s.slice(a,l)}for(f=s.length-1;f>=0;--f)if(s.charCodeAt(f)===47){if(!d){a=f+1;break}}else l===-1&&(d=!1,l=f+1);return l===-1?"":s.slice(a,l)},extname:function(s){o(s);for(var m=-1,f=0,a=-1,l=!0,d=0,g=s.length-1;g>=0;--g){var v=s.charCodeAt(g);if(v!==47)a===-1&&(l=!1,a=g+1),v===46?m===-1?m=g:d!==1&&(d=1):m!==-1&&(d=-1);else if(!l){f=g+1;break}}return m===-1||a===-1||d===0||d===1&&m===a-1&&m===f+1?"":s.slice(m,a)},format:function(s){if(s===null||typeof s!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof s);return function(m,f){var a=f.dir||f.root,l=f.base||(f.name||"")+(f.ext||"");return a?a===f.root?a+l:a+"/"+l:l}(0,s)},parse:function(s){o(s);var m={root:"",dir:"",base:"",ext:"",name:""};if(s.length===0)return m;var f,a=s.charCodeAt(0),l=a===47;l?(m.root="/",f=1):f=0;for(var d=-1,g=0,v=-1,x=!0,S=s.length-1,E=0;S>=f;--S)if((a=s.charCodeAt(S))!==47)v===-1&&(x=!1,v=S+1),a===46?d===-1?d=S:E!==1&&(E=1):d!==-1&&(E=-1);else if(!x){g=S+1;break}return d===-1||v===-1||E===0||E===1&&d===v-1&&d===g+1?v!==-1&&(m.base=m.name=g===0&&l?s.slice(1,v):s.slice(g,v)):(g===0&&l?(m.name=s.slice(1,d),m.base=s.slice(1,v)):(m.name=s.slice(g,d),m.base=s.slice(g,v)),m.ext=s.slice(d,v)),g>0?m.dir=s.slice(0,g-1):l&&(m.dir="/"),m},sep:"/",delimiter:":",win32:null,posix:null};u.posix=u,i.exports=u}},t={};function r(i){var o=t[i];if(o!==void 0)return o.exports;var c=t[i]={exports:{}};return e[i](c,c.exports,r),c.exports}r.d=(i,o)=>{for(var c in o)r.o(o,c)&&!r.o(i,c)&&Object.defineProperty(i,c,{enumerable:!0,get:o[c]})},r.o=(i,o)=>Object.prototype.hasOwnProperty.call(i,o),r.r=i=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})};var n={};(()=>{var i;if(r.r(n),r.d(n,{URI:()=>v,Utils:()=>O}),typeof process=="object")i=process.platform==="win32";else if(typeof navigator=="object"){var o=navigator.userAgent;i=o.indexOf("Windows")>=0}var c,u,s=(c=function(y,h){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,w){p.__proto__=w}||function(p,w){for(var T in w)Object.prototype.hasOwnProperty.call(w,T)&&(p[T]=w[T])},c(y,h)},function(y,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");function p(){this.constructor=y}c(y,h),y.prototype=h===null?Object.create(h):(p.prototype=h.prototype,new p)}),m=/^\w[\w\d+.-]*$/,f=/^\//,a=/^\/\//,l="",d="/",g=/^(([^:/?#]+?):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/,v=function(){function y(h,p,w,T,N,_){_===void 0&&(_=!1),typeof h=="object"?(this.scheme=h.scheme||l,this.authority=h.authority||l,this.path=h.path||l,this.query=h.query||l,this.fragment=h.fragment||l):(this.scheme=function(j,Y){return j||Y?j:"file"}(h,_),this.authority=p||l,this.path=function(j,Y){switch(j){case"https":case"http":case"file":Y?Y[0]!==d&&(Y=d+Y):Y=d}return Y}(this.scheme,w||l),this.query=T||l,this.fragment=N||l,function(j,Y){if(!j.scheme&&Y)throw new Error('[UriError]: Scheme is missing: {scheme: "", authority: "'.concat(j.authority,'", path: "').concat(j.path,'", query: "').concat(j.query,'", fragment: "').concat(j.fragment,'"}'));if(j.scheme&&!m.test(j.scheme))throw new Error("[UriError]: Scheme contains illegal characters.");if(j.path){if(j.authority){if(!f.test(j.path))throw new Error('[UriError]: If a URI contains an authority component, then the path component must either be empty or begin with a slash ("/") character')}else if(a.test(j.path))throw new Error('[UriError]: If a URI does not contain an authority component, then the path cannot begin with two slash characters ("//")')}}(this,_))}return y.isUri=function(h){return h instanceof y||!!h&&typeof h.authority=="string"&&typeof h.fragment=="string"&&typeof h.path=="string"&&typeof h.query=="string"&&typeof h.scheme=="string"&&typeof h.fsPath=="string"&&typeof h.with=="function"&&typeof h.toString=="function"},Object.defineProperty(y.prototype,"fsPath",{get:function(){return B(this,!1)},enumerable:!1,configurable:!0}),y.prototype.with=function(h){if(!h)return this;var p=h.scheme,w=h.authority,T=h.path,N=h.query,_=h.fragment;return p===void 0?p=this.scheme:p===null&&(p=l),w===void 0?w=this.authority:w===null&&(w=l),T===void 0?T=this.path:T===null&&(T=l),N===void 0?N=this.query:N===null&&(N=l),_===void 0?_=this.fragment:_===null&&(_=l),p===this.scheme&&w===this.authority&&T===this.path&&N===this.query&&_===this.fragment?this:new S(p,w,T,N,_)},y.parse=function(h,p){p===void 0&&(p=!1);var w=g.exec(h);return w?new S(w[2]||l,P(w[4]||l),P(w[5]||l),P(w[7]||l),P(w[9]||l),p):new S(l,l,l,l,l)},y.file=function(h){var p=l;if(i&&(h=h.replace(/\\/g,d)),h[0]===d&&h[1]===d){var w=h.indexOf(d,2);w===-1?(p=h.substring(2),h=d):(p=h.substring(2,w),h=h.substring(w)||d)}return new S("file",p,h,l,l)},y.from=function(h){return new S(h.scheme,h.authority,h.path,h.query,h.fragment)},y.prototype.toString=function(h){return h===void 0&&(h=!1),Z(this,h)},y.prototype.toJSON=function(){return this},y.revive=function(h){if(h){if(h instanceof y)return h;var p=new S(h);return p._formatted=h.external,p._fsPath=h._sep===x?h.fsPath:null,p}return h},y}(),x=i?1:void 0,S=function(y){function h(){var p=y!==null&&y.apply(this,arguments)||this;return p._formatted=null,p._fsPath=null,p}return s(h,y),Object.defineProperty(h.prototype,"fsPath",{get:function(){return this._fsPath||(this._fsPath=B(this,!1)),this._fsPath},enumerable:!1,configurable:!0}),h.prototype.toString=function(p){return p===void 0&&(p=!1),p?Z(this,!0):(this._formatted||(this._formatted=Z(this,!1)),this._formatted)},h.prototype.toJSON=function(){var p={$mid:1};return this._fsPath&&(p.fsPath=this._fsPath,p._sep=x),this._formatted&&(p.external=this._formatted),this.path&&(p.path=this.path),this.scheme&&(p.scheme=this.scheme),this.authority&&(p.authority=this.authority),this.query&&(p.query=this.query),this.fragment&&(p.fragment=this.fragment),p},h}(v),E=((u={})[58]="%3A",u[47]="%2F",u[63]="%3F",u[35]="%23",u[91]="%5B",u[93]="%5D",u[64]="%40",u[33]="%21",u[36]="%24",u[38]="%26",u[39]="%27",u[40]="%28",u[41]="%29",u[42]="%2A",u[43]="%2B",u[44]="%2C",u[59]="%3B",u[61]="%3D",u[32]="%20",u);function C(y,h){for(var p=void 0,w=-1,T=0;T<y.length;T++){var N=y.charCodeAt(T);if(N>=97&&N<=122||N>=65&&N<=90||N>=48&&N<=57||N===45||N===46||N===95||N===126||h&&N===47)w!==-1&&(p+=encodeURIComponent(y.substring(w,T)),w=-1),p!==void 0&&(p+=y.charAt(T));else{p===void 0&&(p=y.substr(0,T));var _=E[N];_!==void 0?(w!==-1&&(p+=encodeURIComponent(y.substring(w,T)),w=-1),p+=_):w===-1&&(w=T)}}return w!==-1&&(p+=encodeURIComponent(y.substring(w))),p!==void 0?p:y}function W(y){for(var h=void 0,p=0;p<y.length;p++){var w=y.charCodeAt(p);w===35||w===63?(h===void 0&&(h=y.substr(0,p)),h+=E[w]):h!==void 0&&(h+=y[p])}return h!==void 0?h:y}function B(y,h){var p;return p=y.authority&&y.path.length>1&&y.scheme==="file"?"//".concat(y.authority).concat(y.path):y.path.charCodeAt(0)===47&&(y.path.charCodeAt(1)>=65&&y.path.charCodeAt(1)<=90||y.path.charCodeAt(1)>=97&&y.path.charCodeAt(1)<=122)&&y.path.charCodeAt(2)===58?h?y.path.substr(1):y.path[1].toLowerCase()+y.path.substr(2):y.path,i&&(p=p.replace(/\//g,"\\")),p}function Z(y,h){var p=h?W:C,w="",T=y.scheme,N=y.authority,_=y.path,j=y.query,Y=y.fragment;if(T&&(w+=T,w+=":"),(N||T==="file")&&(w+=d,w+=d),N){var ne=N.indexOf("@");if(ne!==-1){var $e=N.substr(0,ne);N=N.substr(ne+1),(ne=$e.indexOf(":"))===-1?w+=p($e,!1):(w+=p($e.substr(0,ne),!1),w+=":",w+=p($e.substr(ne+1),!1)),w+="@"}(ne=(N=N.toLowerCase()).indexOf(":"))===-1?w+=p(N,!1):(w+=p(N.substr(0,ne),!1),w+=N.substr(ne))}if(_){if(_.length>=3&&_.charCodeAt(0)===47&&_.charCodeAt(2)===58)(Se=_.charCodeAt(1))>=65&&Se<=90&&(_="/".concat(String.fromCharCode(Se+32),":").concat(_.substr(3)));else if(_.length>=2&&_.charCodeAt(1)===58){var Se;(Se=_.charCodeAt(0))>=65&&Se<=90&&(_="".concat(String.fromCharCode(Se+32),":").concat(_.substr(2)))}w+=p(_,!0)}return j&&(w+="?",w+=p(j,!1)),Y&&(w+="#",w+=h?Y:C(Y,!1)),w}function X(y){try{return decodeURIComponent(y)}catch{return y.length>3?y.substr(0,3)+X(y.substr(3)):y}}var oe=/(%[0-9A-Za-z][0-9A-Za-z])+/g;function P(y){return y.match(oe)?y.replace(oe,function(h){return X(h)}):y}var O,I=r(470),M=function(y,h,p){if(p||arguments.length===2)for(var w,T=0,N=h.length;T<N;T++)!w&&T in h||(w||(w=Array.prototype.slice.call(h,0,T)),w[T]=h[T]);return y.concat(w||Array.prototype.slice.call(h))},A=I.posix||I,D="/";(function(y){y.joinPath=function(h){for(var p=[],w=1;w<arguments.length;w++)p[w-1]=arguments[w];return h.with({path:A.join.apply(A,M([h.path],p,!1))})},y.resolvePath=function(h){for(var p=[],w=1;w<arguments.length;w++)p[w-1]=arguments[w];var T=h.path,N=!1;T[0]!==D&&(T=D+T,N=!0);var _=A.resolve.apply(A,M([T],p,!1));return N&&_[0]===D&&!h.authority&&(_=_.substring(1)),h.with({path:_})},y.dirname=function(h){if(h.path.length===0||h.path===D)return h;var p=A.dirname(h.path);return p.length===1&&p.charCodeAt(0)===46&&(p=""),h.with({path:p})},y.basename=function(h){return A.basename(h.path)},y.extname=function(h){return A.extname(h.path)}})(O||(O={}))})(),zn=n})();var{URI:St,Utils:Pa}=zn;var ei=require("child_process"),ti=se(require("readline")),Pt=require("coc.nvim");var me=require("coc.nvim");var Qn={warn:Ve("warn"),info:Ve("info"),error:Ve("info")};function xt(e,t=!1){me.window.showErrorMessage(e),t&&me.window.showNotification({kind:"error",title:ie,content:e}),Qn.error(e)}function Xn(e,t=!1){me.window.showWarningMessage(e),t&&me.window.showNotification({kind:"warning",title:ie,content:e}),Qn.warn(e)}var tt=e=>e.replace(me.workspace.cwd+"/","");async function Zn(e){let{nvim:t}=me.workspace;(await t.getOption("runtimepath")).split(",").includes(e)||await t.command(`execute 'noa set rtp+='.fnameescape('${e.replace(/'/g,"''")}')`)}var Tt=class{constructor(){this._tagsOnlyView=new Map(F.tags.map(t=>[t.tagName,[]]));this._flatView=new Map;this._treeView=new Map;this.mode=F.defaultView;this.groupByTag=F.groupByTag}flatView(t){let r=t.fsPath,n={index:t.index,tagName:t.tagName};return this._flatView.has(r)?this._flatView.get(r).push(n):this._flatView.set(r,[n]),this._flatView}tagsOnlyView(t){let r=t.tagName,n=t.index;return this._tagsOnlyView.has(r)?this._tagsOnlyView.get(r).push(n):this._tagsOnlyView.set(r,[n]),this._tagsOnlyView}treeView(t){let{tagName:r,index:n,fsPath:i}=t,o=i.split("/").filter(u=>u),c=this._treeView;return o.forEach((u,s,m)=>{let f=c.get(u);if(m[s+1])if(f)f&&(c=f);else{let a=new Map;c.set(u,a),c=a}else{let a={tagName:r,index:n},l=c.get(u);if(Array.isArray(l))l.push(a);else{let d=[a];c.set(u,d),c=d}}}),this._treeView}generateView(t){this.treeView(t),this.flatView(t),this.tagsOnlyView(t)}clear(){this._treeView.clear(),this._tagsOnlyView.clear(),this._flatView.clear()}get data(){let t=this[`_${this.mode}View`],r=Object.prototype.toString.call(t),n=!1;switch(r){case"[object Map]":{n=t.size!==0;break}default:case"[object Array]":{n=t.length!==0;break}}return n?this[`_${this.mode}View`]:null}switchToNextMode(){var r;let t=ee.findIndex(n=>n===this.mode);t!==-1?this.mode=(r=ee[t+1])!=null?r:ee[0]:this.mode=ee[1]}},_s=new Tt,G=_s;var kt=F.maxGrepColumns,qs=F.maxPreviewWidth||kt,As=F.customCommand,Et=class{constructor(t){this.cwd=Pt.workspace.cwd;this.currentProcess=null;this.resArr=[];this.grep=()=>new Promise(t=>{let r=this.grepString.split(" ");this.currentProcess=(0,ei.spawn)(r[0],r.slice(1),{cwd:this.cwd}),this.currentProcess.on("error",i=>{xt(i.message)}),this.currentProcess.stderr.on("data",i=>{xt(i.toString("utf8"))});let n=ti.default.createInterface(this.currentProcess.stdout);n.on("line",i=>{if(i){let o=Vs(i);o.shortText&&Ds(o.fsPath)&&(o.tagName=this.options.tagName,o.index=this.resArr.length,G.generateView(o),this.resArr.push(o))}}),n.on("close",()=>{t(this.resArr),this.currentProcess&&!this.currentProcess.killed&&this.currentProcess.kill()})});this.options=t,this.grepString=this.genGrepString()}genGrepString(){return this.options.regex?(As||`rg --no-messages --vimgrep -H --column --max-columns ${kt} --max-columns-preview --line-number --color never -e`)+` ${this.options.regex} -- ${Pt.workspace.cwd}`:'echo ""'}handleGrepCancel(){return this.currentProcess&&!this.currentProcess.killed?(this.currentProcess.kill(),this.resArr):[]}},ri=Et;function Ds(e){let t=F.filterFilesRegex;return Array.isArray(t)?!t.some(r=>new RegExp(r).test(e)):!0}function Vs(e){var m,f;let t=RegExp(/^(?<file>.*):(?<line>\d+):(?<column>\d+):(?<tag>.*)/),r,n,i,o,c=t.exec(e);if(c&&c.groups)r=c.groups.file,n=parseInt(c.groups.line),i=parseInt(c.groups.column),o=c.groups.tag;else{r="",e.length>1&&e[1]===":"&&(r=e.substring(0,2),e=e.substring(2));let a=e.split(":"),l=a.length===4;r+=a.shift(),n=parseInt((m=a.shift())!=null?m:""),l===!0?i=parseInt((f=a.shift())!=null?f:""):i=1,o=a.join(":")}let u=[];o=Array.from({length:Math.min(qs,o.length,kt)},(a,l)=>l+(i-1)).map((a,l)=>(l<40&&u.push(o[a]),o[a])).join("");let s=u.join("");return{tagName:"",detail:o,shortText:/\[\.\.\.\u0020\d+\u0020more\u0020matches\]/.test(o)?"":s,line:n,fsPath:r,column:i}}function Ct(e){let t=[],r=G.data,n=F.tags.map(i=>i.tagName);return r&&Array.isArray(n)&&n.length&&n.forEach(i=>{let o=e.find(c=>{var u;return((u=c[0])==null?void 0:u.tagName)===i});o&&t.push({level:0,key:i,tag:i,sourcePath:i,children:Array.from(r.keys()).reduce((c,u)=>{let m=r.get(u).filter(a=>a.tagName===i),f={level:1,sourcePath:u,key:`${i}.${u}`,children:m.map(a=>o[a.index])};return f.children.length&&c.push(f),c},[]).sort((c,u)=>c.sourcePath.localeCompare(u.sourcePath))})}),t}function Nt(e){let t=[],r=G.data;return r&&r.forEach((n,i)=>{t.push({level:0,key:i,sourcePath:i,children:n.reduce((o,c)=>{let u=e.find(s=>{var m;return((m=s[0])==null?void 0:m.tagName)===c.tagName});return u&&o.push(u[c.index]),o},[])})}),t.sort((n,i)=>n.sourcePath.localeCompare(i.sourcePath))}function Ft(e){return e.reduce((r,n)=>{if(Array.isArray(n)&&n.length>0){let i=n[0].tagName;r.push({level:0,tag:i,key:i,sourcePath:i,children:n.map(o=>k(o)?o:{...o,extra:`${tt(o.path)}: ${o.range.start.line}, ${o.range.start.character}`})})}return r},[])}function bt(e){return e.reduce((r,n)=>(r.push(...n.map(i=>k(i)?i:{...i,extra:`${tt(i.path)}: ${i.range.start.line}, ${i.range.start.character}`})),r),[])}var rt=require("coc.nvim"),we=se(De()),ni=se(require("path"));function It(e){let t=F.tags.map(n=>n.tagName),r=[];return t.forEach(n=>{let i=e.find(a=>{var l;return((l=a[0])==null?void 0:l.tagName)===n});if(!i||i.length===0)return;let o={level:0,sourcePath:n,key:n,tag:n,children:[]},c=new Map;i.forEach(a=>{let l=a.path;c.has(l)||c.set(l,[]),c.get(l).push(a)});for(let[a,l]of c.entries()){let g=(a.startsWith(rt.workspace.cwd)?a.slice(rt.workspace.cwd.length+1):a).split("/"),v=o,x=rt.workspace.cwd;for(let E=0;E<g.length-1;E++){let C=g[E];x=ni.default.join(x,C);let W=!1;for(let B of v.children)if(k(B)&&B.sourcePath===x){v=B,W=!0;break}if(!W){let B={level:v.level+1,sourcePath:x,key:`[${n}] [${v.level+1}] ${x}`,children:[]};v.children.push(B),v=B}}let S={level:v.level+1,sourcePath:a,key:`[${n}] [${v.level+1}] ${a}`,children:l};v.children.push(S)}function u(a){return k(a)?(a.children=a.children.filter(l=>k(l)?u(l):!0),a.children.length>0):!0}u(o);function s(a){if(!k(a))return a;if(a.children=a.children.map(l=>k(l)?s(l):l),a.children.length===1&&k(a.children[0])){let l=a.children[0];if(l.children.some(g=>k(g))&&!(0,we.existsSync)(l.sourcePath)||(0,we.existsSync)(l.sourcePath)&&!(0,we.lstatSync)(l.sourcePath).isFile())return{...a,children:l.children}}return a}s(o);function m(a){k(a)&&Array.isArray(a.children)&&(a.children.sort((l,d)=>{if(!l||!d)return 0;let g=k(l)?f(l):!0,v=k(d)?f(d):!0;if(!g&&v)return-1;if(g&&!v)return 1;let x=k(l)&&l.sourcePath||"",S=k(d)&&d.sourcePath||"";return x.localeCompare(S)}),a.children.forEach(l=>{l&&k(l)&&m(l)}))}function f(a){return a.children.some(l=>k(l))?!1:(0,we.existsSync)(a.sourcePath)?(0,we.lstatSync)(a.sourcePath).isFile():!0}m(o),o.children.length>0&&r.push(o)}),r}var ke=require("coc.nvim"),ve=se(De()),ii=se(require("path"));function Ot(e){let t=new Map;e.forEach(u=>{u.forEach(s=>{if(s.path){let m=s.path;t.has(m)||t.set(m,[]),t.get(m).push(s)}})});let r={level:0,sourcePath:ke.workspace.cwd,key:ke.workspace.cwd,children:[]};for(let[u,s]of t.entries()){let f=(u.startsWith(ke.workspace.cwd)?u.slice(ke.workspace.cwd.length+1):u).split("/"),a=r,l=ke.workspace.cwd;for(let g=0;g<f.length-1;g++){let v=f[g];if(!v)continue;l=ii.default.join(l,v);let x=!1;for(let S of a.children)if(k(S)&&S.sourcePath===l){a=S,x=!0;break}if(!x){let S={level:a.level+1,sourcePath:l,key:`[${a.level+1}] ${l}`,children:[]};a.children.push(S),a=S}}let d={level:a.level+1,sourcePath:u,key:`[${a.level+1}] ${u}`,children:s};a.children.push(d)}function n(u){return k(u)?(u.children=u.children.filter(s=>k(s)?n(s):!0),u.children.length>0):!0}n(r);function i(u){if(!k(u))return u;if(u.children=u.children.map(s=>k(s)?i(s):s),u.children.length===1&&k(u.children[0])){let s=u.children[0];if(s.children.some(f=>k(f))&&!(0,ve.existsSync)(s.sourcePath)||(0,ve.existsSync)(s.sourcePath)&&!(0,ve.lstatSync)(s.sourcePath).isFile())return{...u,children:s.children}}return u}i(r);function o(u){k(u)&&Array.isArray(u.children)&&(u.children.sort((s,m)=>{if(!s||!m)return 0;let f=k(s)?c(s):!0,a=k(m)?c(m):!0;if(!f&&a)return-1;if(f&&!a)return 1;let l=k(s)&&s.sourcePath||"",d=k(m)&&m.sourcePath||"";return l.localeCompare(d)}),u.children.forEach(s=>{s&&k(s)&&o(s)}))}function c(u){return u.children.some(s=>k(s))?!1:(0,ve.existsSync)(u.sourcePath)?(0,ve.lstatSync)(u.sourcePath).isFile():!0}return o(r),r.children}function _t(e){if(G.groupByTag)switch(G.mode){case ee[0]:return Ft(e);case ee[2]:return It(e);default:case ee[1]:return Ct(e)}else switch(G.mode){case ee[0]:return bt(e);case ee[2]:return Ot(e);default:case ee[1]:return Nt(e)}}var qt=class{constructor(){this.disposables=[];this.rootItems=[];this._treeView=null;this.opened=[];this.nvim=$.workspace.nvim;this.emitter=new $.Emitter;this.timeout=null;this.fetching=!1;this.autoPreview=F.autoPreview;this.commandsMap=new Map;this.autocmdsArr=Array();this.generateCommands(),this.generateAutocmds()}get treeView(){return this._treeView||this.generateTreeView(),this._treeView}set treeView(t){}generateCommands(){return this.commandsMap.set("showTree",{callback:async()=>{if(this.treeView&&!this.treeView.visible){this.autocmdsArr.map(n=>$.events.on(n.event,n.callback,null,this.disposables));let r=(await $.workspace.document).bufnr;this.prevBufnr=await this.nvim.call("bufwinnr",[r]),await this.treeView.show()}this.refreshTodoItems()},args:void 0}).set("goTo",{callback:t=>oi(t,this.nvim,this.prevBufnr),args:void 0,internal:!0}).set("open",{callback:()=>{},args:void 0,internal:!0}),this.commandsMap}generateAutocmds(){return this.autocmdsArr.push({event:"BufWritePost",callback:()=>{var t;(t=this.treeView)!=null&&t.visible&&this.refreshTodoItems(500)}}),this.autocmdsArr.push({event:"BufEnter",callback:t=>{var r;((r=this._treeView)==null?void 0:r.visible)&&this.previewBufnr&&t!==this.previewBufnr&&(this.prevNode=void 0,this.closePreview())}}),this.autocmdsArr}refreshTodoItems(t=0){this.fetching||(this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(async()=>{let r="Updating items...";await $.window.withProgress({title:`[${ie}] ${r}`,cancellable:!0},async(n,i)=>{let o="";this._treeView.nodesMap.clear(),G.clear(),this._treeView.message=o;let c=0,u=F.tags.map(s=>new ri({regex:s.regex,tagName:s.tagName}));return i.onCancellationRequested(()=>{let s="Grep canceled";o=`${s}: `,Xn(s);let m=u.map(f=>(c+=f.resArr.length,si(f.handleGrepCancel())));this.rootItems=_t(m)}),new Promise(s=>{this.fetching=!0,this.rootItems=[],o="All ",Promise.all(u.map(async m=>si(await m.grep()))).then(m=>{u.forEach(f=>c+=f.resArr.length),this._treeView.message=o+`${c} items`,this._treeView.description=`${G.groupByTag?"group by tag;":""} ${G.mode} view`,this.rootItems=_t(m),s()})})}),this.emitter.fire(void 0),this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.fetching=!1},t))}generateTreeView(){let t={resolveActions:async(r,n)=>[{title:"open it and close tree",handler:async()=>{let o=(await $.workspace.document).bufnr,c=await this.nvim.call("bufwinnr",[o]);await oi(n,this.nvim,this.prevBufnr),await this.nvim.command(`${c}wincmd c`)}}],onDidChangeTreeData:this.emitter.event,getChildren:r=>{if(!r)return this.rootItems;if(k(r))return r.children},getTreeItem:r=>{var i,o,c,u,s,m,f,a,l,d,g,v,x,S;let n;if(k(r)){let E,C,W="",B=this.opened.findIndex(X=>X.key===r.key)!==-1?$.TreeItemCollapsibleState.Expanded:$.TreeItemCollapsibleState.Collapsed,Z="";if(typeof r.tag=="string"){let X=F.tags.find(oe=>oe.tagName===r.tag);X&&(E=(i=X==null?void 0:X.icon)==null?void 0:i.text,Z=r.tag,C=((o=F)==null?void 0:o.groupTagIconHighlight)||((c=X.icon)==null?void 0:c.hlGroup))}else W=r.sourcePath.replace($.workspace.cwd+"/",""),(0,ai.lstatSync)(r.sourcePath).isFile()?(E=(s=(u=F)==null?void 0:u.fileIcon)==null?void 0:s.text,C=(f=(m=F)==null?void 0:m.fileIcon)==null?void 0:f.hlGroup):(E=(l=(a=F)==null?void 0:a.folderIcon)==null?void 0:l.text,C=(g=(d=F)==null?void 0:d.folderIcon)==null?void 0:g.hlGroup),Z=(v=r.name)!=null?v:ci.default.basename(St.file(r.sourcePath).path);n=new $.TreeItem(Z,B),n.command={command:`${ie}.open`,title:"open it",arguments:[r]},n.description=W,F.parentNodeHighlightEnabled&&(n.label={highlights:[[0,Z.length]],label:Z}),E&&(n.icon={hlGroup:C||ge.fileIcon.hlGroup,text:E})}else{let{shortText:E}=r,C=(x=F.tags.find(B=>B.tagName===r.tagName))==null?void 0:x.icon;n=new $.TreeItem(`${E}`,$.TreeItemCollapsibleState.None);let W=(S=r.extra)!=null?S:`[${r.range.start.line}, ${r.range.start.character}]`;C&&(n.icon={hlGroup:C==null?void 0:C.hlGroup,text:C==null?void 0:C.text}),n.command={command:`${ie}.goTo`,title:"go to it",arguments:[r]},n.description=W}return n}};return this._treeView=$.window.createTreeView("Todo",{treeDataProvider:t,bufhidden:"hide",autoWidth:!0}),this._treeView.onDidExpandElement(({element:r})=>{if(k(r)){let{key:n}=r;if(this.opened.find(i=>i.key===n))return;this.opened.push({key:n})}}),this._treeView.onDidCollapseElement(({element:r})=>{if(k(r)){let{key:n}=r,i=this.opened.findIndex(o=>o.key===n);i!==-1&&this.opened.splice(i,1)}}),this._treeView._collapseAll=this._treeView.collapseAll,this._treeView.collapseAll=(...r)=>{this._treeView._collapseAll(...r),this.opened=[]},this._treeView.onDidChangeVisibility(({visible:r})=>{r||(this.closePreview(),(0,$.disposeAll)(this.disposables))}),this._treeView.registerLocalKeymap("n",F.toggleGroupByTagKey,async()=>{this.closePreview(),G.groupByTag=!G.groupByTag,this.refreshTodoItems()},!0),this._treeView.registerLocalKeymap("n",F.refreshItemsKey,async()=>{this.closePreview(),this.refreshTodoItems()},!0),this._treeView.registerLocalKeymap("n",F.invokeKey,async r=>{k(r)?this._treeView.toggleExpand(r):this._treeView.invokeCommand(r)},!0),this._treeView.registerLocalKeymap("n",F.togglePreviewKey,async r=>{this.autoPreview=!this.autoPreview,this.doPreview(r)},!0),this._treeView.registerLocalKeymap("n",F.switchViewKey,async()=>{this.opened=[],G.switchToNextMode(),this.closePreview(),this.refreshTodoItems()},!0),this._treeView.onDidCursorMoved(async r=>{this.prevNode!==r&&(this.prevNode=r,this.previewBufnr=await this.doPreview(r))}),this._treeView}async doPreview(t){var r,n,i,o,c,u,s,m,f,a,l,d,g,v,x,S;if(t&&this.autoPreview){let E={lines:[],border:(i=(r=F.previewWinConfig)==null?void 0:r.border)!=null?i:(n=ge.previewWinConfig)==null?void 0:n.border,rounded:(u=(o=F.previewWinConfig)==null?void 0:o.rounded)!=null?u:(c=ge.previewWinConfig)==null?void 0:c.rounded,maxWidth:F.maxPreviewWidth,highlight:(f=(s=F.previewWinConfig)==null?void 0:s.highlight)!=null?f:(m=ge.previewWinConfig)==null?void 0:m.highlight,borderhighlight:(d=(a=F.previewWinConfig)==null?void 0:a.borderhighlight)!=null?d:(l=ge.previewWinConfig)==null?void 0:l.borderhighlight,winblend:(x=(g=F.previewWinConfig)==null?void 0:g.winblend)!=null?x:(v=ge.previewWinConfig)==null?void 0:v.winblend,filetype:"text"};if(k(t)){if(t.tag){this.closePreview();return}else E.lines.push(t.sourcePath.replace($.workspace.cwd+"/",""));E.maxWidth=1e3}else if(!k(t)){let C=(S=t.extra)!=null?S:`[Line ${t.range.start.line}, Col ${t.range.start.character}]`,W=`${t.detail}

${C}`;E.lines=(W==null?void 0:W.split(`
`))||[]}return await this.nvim.call("coc_todo_tree#preview",E)}else this.closePreview()}closePreview(){this.nvim.call("coc_todo_tree#close_preview",[],!0)}},ui=qt;function k(e){return!!Object.prototype.hasOwnProperty.call(e,"sourcePath")}async function oi(e,t,r){if(!k(e)){let n=St.file(e.path).toString();await t.command(`${r!=null?r:""}wincmd w`),await $.workspace.jumpTo(n,{line:e.range.start.line-1,character:e.range.start.character-1})}}function si(e){return e.map(t=>({tagName:t.tagName,detail:t.detail,shortText:t.shortText,path:t.fsPath,range:{start:{character:t.column,line:t.line},end:{character:t.column,line:t.line}}}))}var fi=require("coc.nvim");var li;function Ve(e){return t=>li[e](t)}async function $s(e){if(F.enabled===!1)return;let{subscriptions:t,logger:r}=e;li=r;let n=new ui;process.debugPort!==6989&&await Zn(e.extensionPath),t.push(...Ms(ie,n.commandsMap))}function Ms(e,t){return Array.from(t.keys()).map(r=>{let{callback:n,args:i,internal:o}=t.get(r);return fi.commands.registerCommand(`${e}.${r}`,n,i,o)})}0&&(module.exports={activate,log});
